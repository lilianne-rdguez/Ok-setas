---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";

const categories = [
    {
        name: "Microdosis",
        description: "Protocolos de optimización cognitiva y bienestar emocional.",
        products: [
            {
                id: "2-1-pack",
                title: "2+1 Pack Microdosis",
                price: "27,98 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2022/04/5-3pack-de-microdosis-de-trufas-magicas.png",
                url: "/producto/2-1-pack-microdosis",
            },
            {
                id: "3-1-pack",
                title: "3+1 Pack Microdosis",
                price: "41,97 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2022/04/5-3pack-de-microdosis-de-trufas-magicas.png",
                url: "/producto/3-1-pack-microdosis",
            },
            {
                id: "4-2-pack",
                title: "4+2 Pack Microdosis",
                price: "55,96 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2022/04/5-3pack-de-microdosis-de-trufas-magicas.png",
                url: "/producto/4-2-pack-microdosis",
            },
            {
                id: "5-3-pack",
                title: "5+3 Pack Microdosis",
                price: "69,95 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2022/04/5-3pack-de-microdosis-de-trufas-magicas.png",
                url: "/producto/5-3-pack-microdosis",
            },
        ],
    },
    {
        name: "Trufas Mágicas",
        description: "Esclerocios de psilocibina para experiencias introspectivas.",
        products: [
            {
                id: "trufas-atlantis",
                title: "Psilocybe Atlantis",
                price: "16,95 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2026/01/trufas-magicas-psilocybe-atlantis-500x500.jpg",
                url: "/producto/trufas-atlantis",
            },
            {
                id: "trufas-hollandia",
                title: "Psilocybe Hollandia",
                price: "21,50 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2022/04/trufas-magicas-psilocybe-hollandia-500x500.jpg",
                url: "/producto/trufas-hollandia",
            },
            {
                id: "trufas-cattaleya",
                title: "Psilocybe Cattaleya",
                price: "22,95 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2026/01/trufas-magicas-psilocybe-cattaleya-1-500x500.jpg",
                url: "/producto/trufas-cattaleya",
            },
        ],
    },
    {
        name: "Kits de Cultivo",
        description: "Kits completos de micelio 100% colonizado listos para fructificar.",
        products: [
            {
                id: "kit-orissa",
                title: "Kit Orissa India",
                price: "36,00 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2026/01/kit-de-cultivo-de-setas-psilocybe-cubensis-orissa-india-500x500.jpg",
                url: "/producto/kit-orissa-india",
            },
            {
                id: "kit-treasure",
                title: "Kit Treasure Coast",
                price: "36,00 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2026/01/kit-de-cultivo-de-setas-psilocybe-cubensis-treasure-coast-500x500.jpg",
                url: "/producto/kit-treasure-coast",
            },
            {
                id: "kit-vietnam",
                title: "Kit Vietnam",
                price: "36,00 €",
                image: "https://ximoe124.sg-host.com/wp-content/uploads/2026/01/kit-de-cultivo-de-setas-psilocybe-cubensis-vietnam-500x500.jpg",
                url: "/producto/kit-vietnam",
            },
        ],
    },
];
---

<Layout title="Todos los Productos | GrowTrades">
    <Header />
    
    <main class="min-h-screen bg-bg-dark text-white pt-24 pb-24 border-t border-white/5 relative overflow-hidden">
        <!-- Fondos decorativos -->
        <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-gradient-to-bl from-gold/10 to-transparent rounded-full blur-[100px] pointer-events-none z-0"></div>
        <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-gradient-to-tr from-blue-900/10 to-transparent rounded-full blur-[100px] pointer-events-none z-0"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            
            <div class="text-center mb-16 animate-fade-in-up">
                <span class="text-gold font-bold tracking-widest uppercase text-xs mb-2 block">Catálogo Completo</span>
                <h1 class="font-display text-4xl md:text-5xl text-white font-bold uppercase tracking-tight mb-4">Nuestros Productos</h1>
                <div class="h-1 w-16 bg-gradient-to-r from-transparent via-gold to-transparent mx-auto mb-6"></div>
                <p class="text-gray-400 font-light text-lg max-w-2xl mx-auto">
                    Explora nuestra selección completa de optimizadores cognitivos, esclerocios premium y kits de crecimiento autónomo.
                </p>
            </div>

            {categories.map((category) => (
                <section class="mb-24">
                    <div class="mb-10 flex flex-col md:flex-row md:items-end justify-between border-b border-white/10 pb-6">
                        <div>
                            <h2 class="font-display text-3xl font-bold text-white uppercase tracking-wider mb-2">{category.name}</h2>
                            <p class="text-gold tracking-widest text-xs uppercase font-bold">{category.description}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {category.products.map((product) => (
                            <div class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl hover:border-gold/30 transition-all duration-300 flex flex-col group">
                                <a href={product.url} class="block relative w-full aspect-square bg-white p-6 flex items-center justify-center overflow-hidden">
                                    <img 
                                        src={product.image} 
                                        alt={product.title} 
                                        class="w-full h-full object-contain filter drop-shadow-md group-hover:scale-110 group-hover:rotate-2 transition-transform duration-700"
                                    />
                                    <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                </a>

                                <div class="p-6 flex flex-col flex-grow">
                                    <span class="text-gold text-[10px] font-bold uppercase tracking-widest mb-2">{category.name}</span>
                                    <h3 class="font-display text-xl font-bold text-white mb-4 line-clamp-2 leading-tight">
                                        {product.title}
                                    </h3>
                                    
                                    <div class="text-2xl font-mono text-white font-bold tracking-tighter mb-6">
                                        {product.price}
                                    </div>

                                    <div class="mt-auto space-y-3">
                                        <!-- Controles de cantidad -->
                                        <div class="flex items-center border border-white/20 rounded-xl overflow-hidden h-12 bg-white/5">
                                            <button 
                                                class="btn-minus-list hover:bg-white/10 text-white transition-colors w-12 h-full flex items-center justify-center font-bold"
                                                data-id={product.id}
                                            >-</button>
                                            <input 
                                                type="number" 
                                                id={`qty-${product.id}`}
                                                min="1" 
                                                value="1" 
                                                class="flex-1 h-full text-center bg-transparent border-x border-white/20 text-white font-mono font-bold text-base outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none min-w-0"
                                            />
                                            <button 
                                                class="btn-plus-list hover:bg-white/10 text-gold transition-colors w-12 h-full flex items-center justify-center font-bold"
                                                data-id={product.id}
                                            >+</button>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3">
                                            <button 
                                                class="btn-add-to-cart-list bg-[#A03D45] text-white font-bold py-3 rounded-xl hover:bg-red-800 transition-all duration-300 flex items-center justify-center gap-2 uppercase tracking-widest text-[10px] sm:text-xs"
                                                data-id={product.id}
                                                data-product={JSON.stringify(product)}
                                            >
                                                <span class="material-symbols-outlined text-sm">shopping_cart</span>
                                                Añadir
                                            </button>
                                            <a href={product.url} class="bg-transparent border border-white/20 text-white font-bold py-3 rounded-xl hover:border-gold hover:text-gold transition-all duration-300 flex items-center justify-center gap-2 uppercase tracking-widest text-[10px] sm:text-xs">
                                                <span class="material-symbols-outlined text-sm">visibility</span>
                                                Ver info
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>
            ))}

        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const minusBtns = document.querySelectorAll('.btn-minus-list');
            const plusBtns = document.querySelectorAll('.btn-plus-list');

            minusBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = (e.currentTarget as HTMLElement).dataset.id;
                    const input = document.getElementById(`qty-${id}`) as HTMLInputElement;
                    if (input) {
                        let val = parseInt(input.value) || 1;
                        if (val > 1) input.value = (val - 1).toString();
                    }
                });
            });

            plusBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = (e.currentTarget as HTMLElement).dataset.id;
                    const input = document.getElementById(`qty-${id}`) as HTMLInputElement;
                    if (input) {
                        let val = parseInt(input.value) || 1;
                        input.value = (val + 1).toString();
                    }
                });
            });

            // Restricción general para los inputs numéricos manuales
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    const target = e.target as HTMLInputElement;
                    let val = parseInt(target.value);
                    if (isNaN(val) || val < 1) {
                        target.value = "1";
                    }
                });
            });

            // Añadir al carrito global
            const addBtns = document.querySelectorAll('.btn-add-to-cart-list');
            addBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const button = e.currentTarget as HTMLElement;
                    const id = button.dataset.id;
                    const productData = JSON.parse(button.dataset.product || '{}');
                    const qtyInput = document.getElementById(`qty-${id}`) as HTMLInputElement;
                    const quantity = parseInt(qtyInput ? qtyInput.value : "1") || 1;
                    
                    if ((window as any).addToCartGlobal) {
                        (window as any).addToCartGlobal({ ...productData, quantity });
                    }
                });
            });
        });
    </script>
</Layout>

<style>
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
    }
</style>
